<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>í”„ë ˆì„ë³„ PNG ìº¡ì²˜ & GIF ë³€í™˜</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gifshot/0.3.2/gifshot.min.js"></script>
    <style>
      #capture-area {
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        border: 1px solid #ccc;
        margin-bottom: 16px;
      }
      .options {
        margin: 12px 0;
      }
      label {
        display: block;
        margin: 8px 0 4px;
      }
    </style>
  </head>
  <body>
    <h3>í•œ ê¸€ìì”© PNG ìº¡ì²˜ & GIF ìƒì„±ê¸°</h3>
    <p>í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê³  ì˜µì…˜ì„ ì¡°ì •í•œ ë’¤ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>

    <div class="options">
      <label>í…ìŠ¤íŠ¸ ì…ë ¥:</label>
      <input id="textInput" value="ğŸ“¦ì•ˆë…•ğŸ˜€" />

      <label>ë°°ê²½ ìƒ‰ìƒ:</label>
      <input type="color" id="bgColor" value="#ffffff" />

      <label>ê¸€ì ìƒ‰ìƒ:</label>
      <input type="color" id="textColor" value="#000000" />

      <label>ê¸€ì í¬ê¸°: <span id="fontSizeValue">48</span>px</label>
      <input type="range" id="fontSize" min="24" max="120" value="48" />

      <label>í”„ë ˆì„ ê°„ ì†ë„ (ms): <span id="speedValue">200</span>ms</label>
      <input type="range" id="speed" min="50" max="1000" step="50" value="200" />

      <label>GIF ê°€ë¡œ í¬ê¸°(px): <span id="widthValue">100</span></label>
      <input type="range" id="width" min="50" max="400" value="100" />

      <label>GIF ì„¸ë¡œ í¬ê¸°(px): <span id="heightValue">100</span></label>
      <input type="range" id="height" min="50" max="400" value="100" />

      <label>í•´ìƒë„ ë°°ìœ¨ (1x~16x): <span id="scaleValue">1</span></label>
      <input type="range" id="scale" min="1" max="16" step="1" value="1" />

      <label>í°íŠ¸ ì„ íƒ:</label>
      <select id="fontFamily">
        <option value='"Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif'>Emoji Default</option>
        <option value="system-ui">System UI</option>
        <option value="Noto Sans KR">Noto Sans KR</option>
        <option value="Arial">Arial</option>
        <option value="'Courier New'">Courier New</option>
        <option value="'Times New Roman'">Times New Roman</option>
        <option value="CustomFont">[ì—…ë¡œë“œí•œ ì»¤ìŠ¤í…€ í°íŠ¸]</option>
      </select>

      <label>ğŸ“ ì»¤ìŠ¤í…€ í°íŠ¸ íŒŒì¼ ì—…ë¡œë“œ (.ttf/.woff)</label>
      <input type="file" id="customFontFile" accept=".ttf,.woff" />
    </div>

    <button onclick="captureFrames()">ìº¡ì²˜ ë° GIF ìƒì„±</button>
    <br /><br />
    <div id="capture-area"></div>
    <div id="download-container"></div>

    <script>
      const updateLabel = (id, value) => (document.getElementById(id).innerText = value);
      ["fontSize", "speed", "width", "height", "scale"].forEach((id) => {
        const input = document.getElementById(id);
        const valueLabel = document.getElementById(id + "Value");

        input.addEventListener("input", () => {
          valueLabel.innerText = input.value;
        });
      });

      // ì»¤ìŠ¤í…€ í°íŠ¸ ì—…ë¡œë“œ ì²˜ë¦¬
      document.getElementById("customFontFile").addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (event) {
          const fontData = event.target.result;
          const style = document.createElement("style");
          style.innerHTML = `
            @font-face {
              font-family: 'CustomFont';
              src: url('${fontData}');
            }
          `;
          document.head.appendChild(style);
          alert("âœ… ì»¤ìŠ¤í…€ í°íŠ¸ ì ìš©ë¨. [ì—…ë¡œë“œí•œ ì»¤ìŠ¤í…€ í°íŠ¸] ì„ íƒí•˜ì„¸ìš”.");
        };
        reader.readAsDataURL(file);
      });

      async function captureFrames() {
        const text = document.getElementById("textInput").value.trim();
        const bgColor = document.getElementById("bgColor").value;
        const textColor = document.getElementById("textColor").value;
        const fontSize = parseInt(document.getElementById("fontSize").value, 10);
        const frameDelay = parseInt(document.getElementById("speed").value, 10);
        const gifWidth = parseInt(document.getElementById("width").value, 10);
        const gifHeight = parseInt(document.getElementById("height").value, 10);
        const scale = parseInt(document.getElementById("scale").value, 10);
        const fontFamily = document.getElementById("fontFamily").value;

        const captureArea = document.getElementById("capture-area");
        const container = document.getElementById("download-container");
        const frameImages = [];

        captureArea.style.width = gifWidth * scale + "px";
        captureArea.style.height = gifHeight * scale + "px";
        captureArea.style.fontSize = fontSize * scale + "px";
        captureArea.style.backgroundColor = bgColor;
        captureArea.style.color = textColor;
        captureArea.style.fontFamily = fontFamily;

        container.innerHTML = "";

        const chars = Array.from(text);
        for (let i = 0; i < chars.length; i++) {
          captureArea.innerText = chars[i];

          await new Promise((resolve) => setTimeout(resolve, 100));
          const canvas = await html2canvas(captureArea, { scale: 1 });
          const dataURL = canvas.toDataURL("image/png");
          frameImages.push(dataURL);
        }

        gifshot.createGIF(
          {
            images: frameImages,
            interval: frameDelay / 1000,
            gifWidth,
            gifHeight,
            numFrames: frameImages.length,
            frameDuration: 1,
            sampleInterval: 10,
          },
          function (obj) {
            if (!obj.error) {
              const image = obj.image;
              const preview = document.createElement("img");
              preview.src = image;
              document.body.appendChild(preview);

              const downloadLink = document.createElement("a");
              downloadLink.href = image;
              downloadLink.download = "output.gif";
              downloadLink.textContent = "GIF ë‹¤ìš´ë¡œë“œ";
              document.body.appendChild(downloadLink);
            } else {
              console.error("GIF ìƒì„± ì‹¤íŒ¨:", obj.errorMsg);
            }
          }
        );
      }
    </script>
  </body>
</html>
